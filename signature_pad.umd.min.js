!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.SignaturePad=i()}(this,function(){"use strict";var t=function(){function t(t,i,o){this.x=t,this.y=i,this.time=o||Date.now()}return t.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},t.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0},t}(),i=function(){function i(t,i,o,e,n,s){this.startPoint=t,this.control2=i,this.control1=o,this.endPoint=e,this.startWidth=n,this.endWidth=s}return i.fromPoints=function(t,o){var e=this.calculateControlPoints(t[0],t[1],t[2]).c2,n=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new i(t[1],e,n,t[2],o.start,o.end)},i.calculateControlPoints=function(i,o,e){var n=i.x-o.x,s=i.y-o.y,a=o.x-e.x,r=o.y-e.y,h=(i.x+o.x)/2,c=(i.y+o.y)/2,d=(o.x+e.x)/2,u=(o.y+e.y)/2,l=Math.sqrt(n*n+s*s),p=Math.sqrt(a*a+r*r),v=p/(l+p),m=d+(h-d)*v,f=u+(c-u)*v,_=o.x-m,y=o.y-f;return{c1:new t(h+_,c+y),c2:new t(d+_,u+y)}},i.prototype.length=function(){for(var t,i,o=0,e=0;e<=10;e+=1){var n=e/10,s=this.point(n,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),a=this.point(n,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(e>0){var r=s-t,h=a-i;o+=Math.sqrt(r*r+h*h)}t=s,i=a}return o},i.prototype.point=function(t,i,o,e,n){return i*(1-t)*(1-t)*(1-t)+3*o*(1-t)*(1-t)*t+3*e*(1-t)*t*t+n*t*t*t},i}();return function(){function o(t,i){void 0===i&&(i={});var e=this;this.canvas=t,this.options=i,this.velocityFilterWeight=i.velocityFilterWeight||.7,this.animationSpeedFactor=i.animationSpeedFactor||2,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||1.2,this.throttle="throttle"in i?i.throttle:16,this.minDistance="minDistance"in i?i.minDistance:3,this.throttle?this._strokeMoveUpdate=function(t,i){void 0===i&&(i=250);var o,e,n,s=0,a=null,r=function(){s=Date.now(),a=null,o=t.apply(e,n),a||(e=null,n=[])};return function(){for(var h=[],c=0;c<arguments.length;c++)h[c]=arguments[c];var d=Date.now(),u=i-(d-s);return e=this,n=h,u<=0||u>i?(a&&(clearTimeout(a),a=null),s=d,o=t.apply(e,n),a||(e=null,n=[])):a||(a=setTimeout(r,u)),o}}(o.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=o.prototype._strokeUpdate,this.dotSize=i.dotSize||function(){return this.maxWidth},this.penColor=i.penColor||"#00000066",this.penWidthFactor=i.penWidthFactor||10,this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this.onBegin=i.onBegin,this.onEnd=i.onEnd,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(e._mouseButtonDown=!0,e._strokeBegin(t))},this._handleMouseMove=function(t){e._mouseButtonDown&&e._strokeMoveUpdate(t)},this._handleMouseUp=function(t){1===t.which&&e._mouseButtonDown&&(e._mouseButtonDown=!1,e._strokeEnd(t))},this._handleTouchStart=function(t){if(t.preventDefault(),1===t.targetTouches.length){var i=t.changedTouches[0];e._strokeBegin(i)}},this._handleTouchMove=function(t){t.preventDefault();var i=t.targetTouches[0];e._strokeMoveUpdate(i)},this._handleTouchEnd=function(t){if(t.target===e.canvas){t.preventDefault();var i=t.changedTouches[0];e._strokeEnd(i)}},"undefined"!=typeof document&&this.on()}return o.prototype.clear=function(){var t=this._ctx,i=this.canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,i.width,i.height),t.fillRect(0,0,i.width,i.height),this._data=[],this._reset(),this._isEmpty=!0},o.prototype.fromDataURL=function(t,i){var o=this;void 0===i&&(i={});var e=new Image,n=i.ratio||window.devicePixelRatio||1,s=i.width||this.canvas.width/n,a=i.height||this.canvas.height/n;this._reset(),e.src=t,e.onload=function(){o._ctx.drawImage(e,0,0,s,a)},this._isEmpty=!1},o.prototype.toDataURL=function(t,i){switch(t){case"image/svg+xml":return this._toSVG();default:return this.canvas.toDataURL(t,i)}},o.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},o.prototype.off=function(){this.canvas.style.msTouchAction="auto",this.canvas.style.touchAction="auto",this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)},o.prototype.isEmpty=function(){return this._isEmpty},o.prototype.fromData=function(t){var i=this;this.clear(),this._fromData(t,function(t){var o=t.color,e=t.curve,n=t.widthFactor;return i._drawCurve({color:o,curve:e,widthFactor:n})},function(t){var o=t.color,e=t.point,n=t.widthFactor;return i._drawDot({color:o,point:e,widthFactor:n})}),this._data=t},o.prototype.toData=function(){return this._data},o.prototype.startAnimating=function(){this.stopAnimating(),this._dataToAnimate=this._data.slice();var t=this._ctx,i=this.canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,i.width,i.height),t.fillRect(0,0,i.width,i.height),this._animateNextPointGroup()},o.prototype.stopAnimating=function(){this._animationTimeout&&clearTimeout(this._animationTimeout),this._dataToAnimate=[]},o.prototype._animateNextPointGroup=function(){var t=this;if(0!==this._dataToAnimate.length){var i=this._dataToAnimate.shift();if(i){var o=i.color,e=i.points,n=i.widthFactor;if(this.penColor=o,!(e.length>1))return this._drawDot({color:o,point:e[0],widthFactor:n}),void(this._animationTimeout=setTimeout(function(){t._animateNextPointGroup()},100/this.animationSpeedFactor));this._pointsToAnimate=e.slice(),this._reset(),this._animateNextPoint(o,n)}}},o.prototype._animateNextPoint=function(i,o){var e=this,n=this._pointsToAnimate.shift();if(n){var s=new t(n.x,n.y,n.time),a=this._addPoint(s);a&&this._drawCurve({color:i,curve:a,widthFactor:o});var r=this._pointsToAnimate[0],h=r?Math.max(r.time-s.time,20):0;this._animationTimeout=setTimeout(function(){e._animateNextPoint(i,o)},h/this.animationSpeedFactor)}else this._animateNextPointGroup()},o.prototype._strokeBegin=function(t){var i={color:this.penColor,points:[],widthFactor:this.penWidthFactor};this._data.push(i),this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},o.prototype._strokeUpdate=function(t){var i=t.clientX,o=t.clientY,e=this._createPoint(i,o),n=this._data[this._data.length-1],s=n.points,a=s.length>0&&s[s.length-1],r=!!a&&e.distanceTo(a)<=this.minDistance,h=n.color,c=n.widthFactor;if(!a||!a||!r){var d=this._addPoint(e);a?d&&this._drawCurve({color:h,curve:d,widthFactor:c}):this._drawDot({color:h,point:e,widthFactor:c}),s.push({time:e.time,x:e.x,y:e.y})}},o.prototype._strokeEnd=function(t){this._strokeUpdate(t),"function"==typeof this.onEnd&&this.onEnd(t)},o.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},o.prototype._handleTouchEvents=function(){this.canvas.style.msTouchAction="none",this.canvas.style.touchAction="none",this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)},o.prototype._reset=function(){this._points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},o.prototype._createPoint=function(i,o){var e=this.canvas.getBoundingClientRect();return new t(i-e.left,o-e.top,(new Date).getTime())},o.prototype._addPoint=function(t){var o=this._points;if(o.push(t),o.length>2){3===o.length&&o.unshift(o[0]);var e=this._calculateCurveWidths(o[1],o[2]),n=i.fromPoints(o,e);return o.shift(),n}return null},o.prototype._calculateCurveWidths=function(t,i){var o=this.velocityFilterWeight*i.velocityFrom(t)+(1-this.velocityFilterWeight)*this._lastVelocity,e=this._strokeWidth(o),n={end:e,start:this._lastWidth};return this._lastVelocity=o,this._lastWidth=e,n},o.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},o.prototype._drawCurveSegment=function(t,i,o){var e=this._ctx;e.moveTo(t,i),e.arc(t,i,o,0,2*Math.PI,!1),this._isEmpty=!1},o.prototype._drawCurve=function(t){var i=t.color,o=t.curve,e=t.widthFactor,n=this._ctx,s=o.endWidth-o.startWidth,a=2*Math.floor(o.length());n.beginPath(),n.fillStyle=i;for(var r=0;r<a;r+=1){var h=r/a,c=h*h,d=c*h,u=1-h,l=u*u,p=l*u,v=p*o.startPoint.x;v+=3*l*h*o.control1.x,v+=3*u*c*o.control2.x,v+=d*o.endPoint.x;var m=p*o.startPoint.y;m+=3*l*h*o.control1.y,m+=3*u*c*o.control2.y,m+=d*o.endPoint.y;var f=o.startWidth+d*s;this._drawCurveSegment(v,m,f*e*this.canvas.height/1e3)}n.closePath(),n.fill()},o.prototype._drawDot=function(t){var i=t.color,o=t.point,e=t.widthFactor,n=this._ctx,s="function"==typeof this.dotSize?this.dotSize():this.dotSize;n.beginPath(),this._drawCurveSegment(o.x,o.y,s*e*this.canvas.height/1e3),n.closePath(),n.fillStyle=i,n.fill()},o.prototype._fromData=function(i,o,e){for(var n=0,s=i;n<s.length;n++){var a=s[n],r=a.color,h=a.points,c=a.widthFactor;if(h.length>1)for(var d=0;d<h.length;d+=1){var u=h[d],l=new t(u.x,u.y,u.time);this.penColor=r,0===d&&this._reset();var p=this._addPoint(l);p&&o({color:r,curve:p,widthFactor:c})}else this._reset(),e({color:r,point:h[0],widthFactor:c})}},o.prototype._toSVG=function(){var t=this,i=this._data,o=Math.max(window.devicePixelRatio||1,1),e=this.canvas.width/o,n=this.canvas.height/o,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("width",this.canvas.width.toString()),s.setAttribute("height",this.canvas.height.toString());var a=2.25*this.canvas.height/1e3;this._fromData(i,function(t){var i=t.color,o=t.curve,e=t.widthFactor,n=document.createElement("path");if(!(isNaN(o.control1.x)||isNaN(o.control1.y)||isNaN(o.control2.x)||isNaN(o.control2.y))){var r="M "+o.startPoint.x.toFixed(3)+","+o.startPoint.y.toFixed(3)+" C "+o.control1.x.toFixed(3)+","+o.control1.y.toFixed(3)+" "+o.control2.x.toFixed(3)+","+o.control2.y.toFixed(3)+" "+o.endPoint.x.toFixed(3)+","+o.endPoint.y.toFixed(3);n.setAttribute("d",r),n.setAttribute("stroke-width",(o.endWidth*e*a).toFixed(3)),n.setAttribute("stroke",i),n.setAttribute("fill","none"),n.setAttribute("stroke-linecap","round"),s.appendChild(n)}},function(i){var o=i.color,e=i.point,n=i.widthFactor,a=document.createElement("circle"),r="function"==typeof t.dotSize?t.dotSize():t.dotSize;a.setAttribute("r",(r*n*t.canvas.height/1e3).toString()),a.setAttribute("cx",e.x.toString()),a.setAttribute("cy",e.y.toString()),a.setAttribute("fill",o),s.appendChild(a)});var r='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+e+" "+n+'" width="'+e+'" height="'+n+'">',h=s.innerHTML;if(void 0===h){var c=document.createElement("dummy"),d=s.childNodes;c.innerHTML="";for(var u=0;u<d.length;u+=1)c.appendChild(d[u].cloneNode(!0));h=c.innerHTML}return"data:image/svg+xml;base64,"+btoa(r+h+"</svg>")},o}()});
